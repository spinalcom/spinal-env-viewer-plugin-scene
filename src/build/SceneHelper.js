function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import { SpinalContext, SpinalGraphService, SpinalNode } from "spinal-env-viewer-graph-service";
import { PART_RELATION_NAME, PART_RELATION_TYPE, SCENE_RELATION_NAME, SCENE_RELATION_TYPE, SCENE_TYPE } from "../constants";

class SceneHelper {
  static initialize() {
    if (SceneHelper.initialized !== null) {
      return SceneHelper.initialized;
    }

    SceneHelper.initialized = new Promise((resolve, reject) => {
      SceneHelper.context = SpinalGraphService.getContext(SceneHelper.contextName);

      if (typeof SceneHelper.context === "undefined") {
        SpinalGraphService.addContext(SceneHelper.contextName, SceneHelper.type).then(context => {
          SceneHelper.context = context;
          SceneHelper.contextId = context.info.id.get();
          console.log(SceneHelper);
          console.log(SceneHelper.contextId);
          resolve(true);
        }).catch(reject);
      } else {
        SceneHelper.contextId = SceneHelper.context.info.id.get();
        console.log(SceneHelper.contextId);
        resolve(true);
      }
    });
    return SceneHelper.initialized;
  }

  static createScene(name, description, autoLoad) {
    return SceneHelper.initialize().then(() => {
      const sceneId = SpinalGraphService.createNode({
        name,
        description,
        autoLoad,
        type: SCENE_TYPE
      }, undefined);
      return SpinalGraphService.addChildInContext(SceneHelper.contextId, sceneId, SceneHelper.contextId, SCENE_RELATION_NAME, SCENE_RELATION_TYPE);
    });
  }

  static addModelToScene(sceneId, bimFileId) {
    return SceneHelper.initialize().then(() => {
      return SpinalGraphService.addChildInContext(sceneId, bimFileId, SceneHelper.contextId, PART_RELATION_NAME, PART_RELATION_TYPE);
    });
  }

  static getBimFilesFromScene(sceneId) {
    return SceneHelper.initialize().then(() => {
      return SpinalGraphService.getChildren(sceneId, [PART_RELATION_NAME]);
    });
  }

  static getSceneFromNode(nodeId) {
    return SceneHelper.initialize().then(() => {
      return SpinalGraphService.getChildren(nodeId, [SCENE_RELATION_NAME]);
    });
  }

  static addSceneToNode(nodeId, sceneId) {
    return SceneHelper.initialize().then(() => {
      return SpinalGraphService.addChildInContext(nodeId, sceneId, SceneHelper.contextId, SCENE_RELATION_NAME, SCENE_RELATION_TYPE);
    });
  }

}

_defineProperty(SceneHelper, "initialized", null);

_defineProperty(SceneHelper, "context", void 0);

_defineProperty(SceneHelper, "contextName", void 0);

_defineProperty(SceneHelper, "type", void 0);

_defineProperty(SceneHelper, "contextId", void 0);

SceneHelper.initialized = null;
SceneHelper.contextName = "Scenes";
SceneHelper.type = "SpinalService";
export { SceneHelper };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL1NjZW5lSGVscGVyLmpzIl0sIm5hbWVzIjpbIlNwaW5hbENvbnRleHQiLCJTcGluYWxHcmFwaFNlcnZpY2UiLCJTcGluYWxOb2RlIiwiUEFSVF9SRUxBVElPTl9OQU1FIiwiUEFSVF9SRUxBVElPTl9UWVBFIiwiU0NFTkVfUkVMQVRJT05fTkFNRSIsIlNDRU5FX1JFTEFUSU9OX1RZUEUiLCJTQ0VORV9UWVBFIiwiU2NlbmVIZWxwZXIiLCJpbml0aWFsaXplIiwiaW5pdGlhbGl6ZWQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwiY29udGV4dE5hbWUiLCJhZGRDb250ZXh0IiwidHlwZSIsInRoZW4iLCJjb250ZXh0SWQiLCJpbmZvIiwiaWQiLCJnZXQiLCJjb25zb2xlIiwibG9nIiwiY2F0Y2giLCJjcmVhdGVTY2VuZSIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsImF1dG9Mb2FkIiwic2NlbmVJZCIsImNyZWF0ZU5vZGUiLCJ1bmRlZmluZWQiLCJhZGRDaGlsZEluQ29udGV4dCIsImFkZE1vZGVsVG9TY2VuZSIsImJpbUZpbGVJZCIsImdldEJpbUZpbGVzRnJvbVNjZW5lIiwiZ2V0Q2hpbGRyZW4iLCJnZXRTY2VuZUZyb21Ob2RlIiwibm9kZUlkIiwiYWRkU2NlbmVUb05vZGUiXSwibWFwcGluZ3MiOiI7O0FBQUEsU0FDRUEsYUFERixFQUVFQyxrQkFGRixFQUdFQyxVQUhGLFFBSU8saUNBSlA7QUFLQSxTQUNFQyxrQkFERixFQUVFQyxrQkFGRixFQUdFQyxtQkFIRixFQUlFQyxtQkFKRixFQUtFQyxVQUxGLFFBTU8sYUFOUDs7QUFTQSxNQUFNQyxXQUFOLENBQWtCO0FBUWhCLFNBQU9DLFVBQVAsR0FBb0I7QUFDbEIsUUFBSUQsV0FBVyxDQUFDRSxXQUFaLEtBQTRCLElBQWhDLEVBQXNDO0FBQ3BDLGFBQU9GLFdBQVcsQ0FBQ0UsV0FBbkI7QUFDRDs7QUFFREYsSUFBQUEsV0FBVyxDQUFDRSxXQUFaLEdB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Q0UsTUFBaEMsRUFBd0MsQ0FBQ25DLG1CQUFELENBQXhDLENBQVA7QUFFRCxLQUhNLENBQVA7QUFJRDs7QUFFRCxTQUFPb0MsY0FBUCxDQUF1QkQsTUFBdkIsRUFBK0JULE9BQS9CLEVBQXlDO0FBQ3ZDLFdBQU92QixXQUFXLENBQUNDLFVBQVosR0FBeUJVLElBQXpCLENBQStCLE1BQU07QUFDMUMsYUFBT2xCLGtCQUFrQixDQUFDaUMsaUJBQW5CLENBQXNDTSxNQUF0QyxFQUE4Q1QsT0FBOUMsRUFBdUR2QixXQUFXLENBQUNZLFNBQW5FLEVBQThFZixtQkFBOUUsRUFBbUdDLG1CQUFuRyxDQUFQO0FBQ0QsS0FGTSxDQUFQO0FBR0Q7O0FBMUVlOztnQkFBWkUsVyxpQkFDaUIsSTs7Z0JBRGpCQSxXOztnQkFBQUEsVzs7Z0JBQUFBLFc7O2dCQUFBQSxXOztBQThFTkEsV0FBVyxDQUFDRSxXQUFaLEdBQTBCLElBQTFCO0FBQ0FGLFdBQVcsQ0FBQ1EsV0FBWixHQUEwQixRQUExQjtBQUNBUixXQUFXLENBQUNVLElBQVosR0FBbUIsZUFBbkI7QUFFQSxTQUFRVixXQUFSIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgU3BpbmFsQ29udGV4dCxcbiAgU3BpbmFsR3JhcGhTZXJ2aWNlLFxuICBTcGluYWxOb2RlXG59IGZyb20gXCJzcGluYWwtZW52LXZpZXdlci1ncmFwaC1zZXJ2aWNlXCI7XG5pbXBvcnQge1xuICBQQVJUX1JFTEFUSU9OX05BTUUsXG4gIFBBUlRfUkVMQVRJT05fVFlQRSxcbiAgU0NFTkVfUkVMQVRJT05fTkFNRSxcbiAgU0NFTkVfUkVMQVRJT05fVFlQRSxcbiAgU0NFTkVfVFlQRVxufSBmcm9tIFwiLi9jb25zdGFudHNcIjtcblxuXG5jbGFzcyBTY2VuZUhlbHBlciB7XG4gIHN0YXRpYyBpbml0aWFsaXplZCA9IG51bGw7XG4gIHN0YXRpYyBjb250ZXh0O1xuICBzdGF0aWMgY29udGV4dE5hbWU7XG4gIHN0YXRpYyB0eXBlIDtcbiAgc3RhdGljIGNvbnRleHRJZDtcbiAgXG4gIFxuICBzdGF0aWMgaW5pdGlhbGl6ZSgpIHtcbiAgICBpZiAoU2NlbmVIZWxwZXIuaW5pdGlhbGl6ZWQgIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBTY2VuZUhlbHBlci5pbml0aWFsaXplZDtcbiAgICB9XG4gICAgXG4gICAgU2NlbmVIZWxwZXIuaW5pdGlhbGl6ZWQgPSBuZXcgUHJvbWlzZSgoIHJlc29sdmUsIHJlamVjdCApID0+IHtcbiAgICAgIFxuICAgICAgU2NlbmVIZWxwZXIuY29udGV4dCA9IFNwaW5hbEdyYXBoU2VydmljZS5nZXRDb250ZXh0KCBTY2VuZUhlbHBlci5jb250ZXh0TmFtZSApO1xuICAgICAgaWYgKHR5cGVvZiBTY2VuZUhlbHBlci5jb250ZXh0ID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIFNwaW5hbEdyYXBoU2VydmljZS5hZGRDb250ZXh0KFNjZW5lSGVscGVyLmNvbnRleHROYW1lLCBTY2VuZUhlbHBlci50eXBlKS50aGVuKGNvbnRleHQgPT4ge1xuICAgICAgICAgIFNjZW5lSGVscGVyLmNvbnRleHQgPSBjb250ZXh0O1xuICAgIFxuICAgICAgICAgIFNjZW5lSGVscGVyLmNvbnRleHRJZCA9IGNvbnRleHQuaW5mby5pZC5nZXQoKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhTY2VuZUhlbHBlcik7XG4gICAgICAgICAgY29uc29sZS5sb2coU2NlbmVIZWxwZXIuY29udGV4dElkKTtcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICB9KS5jYXRjaChyZWplY3QpO1xuICAgICAgfVxuICAgICAgZWxzZXtcbiAgICAgICAgU2NlbmVIZWxwZXIuY29udGV4dElkID0gU2NlbmVIZWxwZXIuY29udGV4dC5pbmZvLmlkLmdldCgpO1xuICAgICAgICBjb25zb2xlLmxvZyhTY2VuZUhlbHBlci5jb250ZXh0SWQpO1xuICAgICAgICByZXNvbHZlKCB0cnVlICk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIFNjZW5lSGVscGVyLmluaXRpYWxpemVkO1xuICB9XG4gIFxuICBzdGF0aWMgY3JlYXRlU2NlbmUoIG5hbWUsIGRlc2NyaXB0aW9uLCBhdXRvTG9hZCApIHtcbiAgICByZXR1cm4gU2NlbmVIZWxwZXIuaW5pdGlhbGl6ZSgpLnRoZW4oICgpID0+IHtcbiAgICAgIGNvbnN0IHNjZW5lSWQgPSBTcGluYWxHcmFwaFNlcnZpY2UuY3JlYXRlTm9kZSgge1xuICAgICAgICBuYW1lLFxuICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgYXV0b0xvYWQsXG4gICAgICAgIHR5cGU6IFNDRU5FX1RZUEVcbiAgICAgIH0sIHVuZGVmaW5lZCApO1xuICAgICAgcmV0dXJuIFNwaW5hbEdyYXBoU2VydmljZS5hZGRDaGlsZEluQ29udGV4dCggU2NlbmVIZWxwZXIuY29udGV4dElkLFxuICAgICAgICBzY2VuZUlkLCBTY2VuZUhlbHBlci5jb250ZXh0SWQsIFNDRU5FX1JFTEFUSU9OX05BTUUsIFNDRU5FX1JFTEFUSU9OX1RZUEUgKTtcbiAgICB9ICk7XG4gICAgXG4gIH1cbiAgXG4gIHN0YXRpYyBhZGRNb2RlbFRvU2NlbmUoIHNjZW5lSWQsIGJpbUZpbGVJZCApIHtcbiAgICByZXR1cm4gU2NlbmVIZWxwZXIuaW5pdGlhbGl6ZSgpXG4gICAgICAudGhlbiggKCkgPT4ge1xuICAgICAgICByZXR1cm4gU3BpbmFsR3JhcGhTZXJ2aWNlLmFkZENoaWxkSW5Db250ZXh0KCBzY2VuZUlkLCBiaW1GaWxlSWQsIFNjZW5lSGVscGVyLmNvbnRleHRJZCxcbiAgICAgICAgICBQQVJUX1JFTEFUSU9OX05BTUUsIFBBUlRfUkVMQVRJT05fVFlQRSApO1xuICAgICAgfSApXG4gIH1cbiAgXG4gIHN0YXRpYyBnZXRCaW1GaWxlc0Zyb21TY2VuZSggc2NlbmVJZCApIHtcbiAgICByZXR1cm4gU2NlbmVIZWxwZXIuaW5pdGlhbGl6ZSgpLnRoZW4oICgpID0+IHtcbiAgICAgIHJldHVybiBTcGluYWxHcmFwaFNlcnZpY2UuZ2V0Q2hpbGRyZW4oIHNjZW5lSWQsIFtQQVJUX1JFTEFUSU9OX05BTUVdICk7XG4gICAgfSApXG4gIH1cbiAgXG4gIHN0YXRpYyBnZXRTY2VuZUZyb21Ob2RlKCBub2RlSWQgKSB7XG4gICAgcmV0dXJuIFNjZW5lSGVscGVyLmluaXRpYWxpemUoKS50aGVuKCAoKSA9PiB7XG4gICAgICByZXR1cm4gU3BpbmFsR3JhcGhTZXJ2aWNlLmdldENoaWxkcmVuKCBub2RlSWQsIFtTQ0VORV9SRUxBVElPTl9OQU1FXSApXG4gICAgICBcbiAgICB9IClcbiAgfVxuICBcbiAgc3RhdGljIGFkZFNjZW5lVG9Ob2RlKCBub2RlSWQsIHNjZW5lSWQgKSB7XG4gICAgcmV0dXJuIFNjZW5lSGVscGVyLmluaXRpYWxpemUoKS50aGVuKCAoKSA9PiB7XG4gICAgICByZXR1cm4gU3BpbmFsR3JhcGhTZXJ2aWNlLmFkZENoaWxkSW5Db250ZXh0KCBub2RlSWQsIHNjZW5lSWQsIFNjZW5lSGVscGVyLmNvbnRleHRJZCwgU0NFTkVfUkVMQVRJT05fTkFNRSwgU0NFTkVfUkVMQVRJT05fVFlQRSApO1xuICAgIH0gKVxuICB9XG4gIFxufVxuXG5TY2VuZUhlbHBlci5pbml0aWFsaXplZCA9IG51bGw7XG5TY2VuZUhlbHBlci5jb250ZXh0TmFtZSA9IFwiU2NlbmVzXCI7XG5TY2VuZUhlbHBlci50eXBlID0gXCJTcGluYWxTZXJ2aWNlXCI7XG5cbmV4cG9ydCB7U2NlbmVIZWxwZXJ9OyJdfQ==